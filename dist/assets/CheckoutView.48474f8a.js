import{l as A,_ as w,o as m,c as v,b as r,t as f,m as O,r as P,f as b,d as g,F as V,h as T,q as U,w as I,u as S,a as C,v as j,k as K,s as q,i as $}from"./index.f3caea87.js";import{B}from"./Breadcrumbs.3743981e.js";var D=A("order",{state:()=>({order:[],status:""}),actions:{async placeOrder(n,c,u,o,e,s,i,a){const d="https://vue-moire.skillbox.cc/api/orders",t=new URLSearchParams;t.append("name",c),t.append("address",u),t.append("phone",o),t.append("email",e),t.append("deliveryTypeId",s),t.append("paymentTypeId",i),t.append("comment",a);const p={method:"POST",headers:{accept:"application/json","Content-Type":"application/x-www-form-urlencoded"},body:t};try{const _=await fetch(`${d}?userAccessKey=${n}`,p);if(this.status=_.status,!_.ok)throw new Error(`HTTP error! Status: ${_.status}`);const h=await _.json();console.log("Response data:",h),this.order=h}catch(_){console.error("Error:",_)}}},persist:{storage:sessionStorage}});const L={name:"DictionaryItem",props:["keyValue","value"]},M={class:"dictionary__item"},z={class:"dictionary__key"},F={class:"dictionary__value"};function Z(n,c,u,o,e,s){return m(),v("li",M,[r("span",z,f(u.keyValue),1),r("span",F,f(u.value),1)])}var G=w(L,[["render",Z]]);const H={components:{DictionaryItem:G,Breadcrumbs:B},computed:{...O(D),computeItemsCount(){const n=this.items.length;return n===0?"0":n===1?"1 \u0442\u043E\u0432\u0430\u0440":[2,3,4].includes(n)?`${n} \u0442\u043E\u0432\u0430\u0440\u0430`:`${n} \u0442\u043E\u0432\u0430\u0440\u043E\u0432`}},data(){return{items:[],basket:[],totalPrice:0}},methods:{calculateTotal(){this.totalPrice=+this.basket.deliveryType.price,this.items.map(n=>{this.totalPrice+=n.price*n.quantity})}},created(){this.orderStore.$subscribe((n,c)=>{this.basket=c.order,this.items=c.order.basket.items,this.calculateTotal()})}},X={class:"content container"},J={class:"content__top"},Q={class:"content__title"},W={class:"cart"},Y={class:"cart__form form",action:"#",method:"POST"},ee={class:"cart__field"},te=r("p",{class:"cart__message"}," \u0411\u043B\u0430\u0433\u043E\u0434\u0430\u0440\u0438\u043C \u0437\u0430\xA0\u0432\u044B\u0431\u043E\u0440 \u043D\u0430\u0448\u0435\u0433\u043E \u043C\u0430\u0433\u0430\u0437\u0438\u043D\u0430. \u041D\u0430\xA0\u0412\u0430\u0448\u0443 \u043F\u043E\u0447\u0442\u0443 \u043F\u0440\u0438\u0434\u0435\u0442 \u043F\u0438\u0441\u044C\u043C\u043E \u0441\xA0\u0434\u0435\u0442\u0430\u043B\u044F\u043C\u0438 \u0437\u0430\u043A\u0430\u0437\u0430. \u041D\u0430\u0448\u0438 \u043C\u0435\u043D\u0435\u0434\u0436\u0435\u0440\u044B \u0441\u0432\u044F\u0436\u0443\u0442\u0441\u044F \u0441\xA0\u0412\u0430\u043C\u0438 \u0432\xA0\u0442\u0435\u0447\u0435\u043D\u0438\u0435 \u0447\u0430\u0441\u0430 \u0434\u043B\u044F \u0443\u0442\u043E\u0447\u043D\u0435\u043D\u0438\u044F \u0434\u0435\u0442\u0430\u043B\u0435\u0439 \u0434\u043E\u0441\u0442\u0430\u0432\u043A\u0438. ",-1),se={class:"dictionary"},ne={class:"cart__block"},re={class:"cart__orders"},ae={class:"cart__order"},oe=r("span",null,"\u0410\u0440\u0442\u0438\u043A\u0443\u043B: 150030",-1),ie={class:"cart__total"};function le(n,c,u,o,e,s){const i=P("Breadcrumbs"),a=P("DictionaryItem");return m(),v("main",X,[r("div",J,[b(i,{title:"\u041E\u0444\u043E\u0440\u043C\u043B\u0435\u043D\u0438\u0435 \u0437\u0430\u043A\u0430\u0437\u0430"}),r("h1",Q,[g(" \u0417\u0430\u043A\u0430\u0437 \u043E\u0444\u043E\u0440\u043C\u043B\u0435\u043D "),r("span",null,"\u2116 "+f(e.basket.id),1)])]),r("section",W,[r("form",Y,[r("div",ee,[te,r("ul",se,[b(a,{keyValue:"\u041F\u043E\u043B\u0443\u0447\u0430\u0442\u0435\u043B\u044C",value:e.basket.name},null,8,["value"]),b(a,{keyValue:"\u0410\u0434\u0440\u0435\u0441 \u0434\u043E\u0441\u0442\u0430\u0432\u043A\u0438",value:e.basket.address},null,8,["value"]),b(a,{keyValue:"\u0422\u0435\u043B\u0435\u0444\u043E\u043D",value:e.basket.phone},null,8,["value"]),b(a,{keyValue:"Email",value:e.basket.email},null,8,["value"]),b(a,{keyValue:"\u0421\u043F\u043E\u0441\u043E\u0431 \u043E\u043F\u043B\u0430\u0442\u044B",value:e.basket.paymentType},null,8,["value"])])]),r("div",ne,[r("ul",re,[(m(!0),v(V,null,T(e.items,d=>(m(),v("li",ae,[r("h3",null,f(d.product.title),1),r("b",null,f(d.quantity*d.price)+" \u20BD",1),oe]))),256))]),r("div",ie,[r("p",null,[g(f(e.basket.deliveryType.title)+": ",1),r("b",null,f(e.basket.deliveryType.price),1),g(" \u20BD")]),r("p",null,[g("\u0418\u0442\u043E\u0433\u043E: "),r("b",null,f(s.computeItemsCount),1),g(" \u043D\u0430 \u0441\u0443\u043C\u043C\u0443 "),r("b",null,f(e.totalPrice)+" \u20BD",1)])])])])])])}var ce=w(H,[["render",le]]),ue=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},R={exports:{}};(function(n,c){(function(u,o){n.exports=o()})(ue,function(){return function(u){function o(s){if(e[s])return e[s].exports;var i=e[s]={i:s,l:!1,exports:{}};return u[s].call(i.exports,i,i.exports,o),i.l=!0,i.exports}var e={};return o.m=u,o.c=e,o.i=function(s){return s},o.d=function(s,i,a){o.o(s,i)||Object.defineProperty(s,i,{configurable:!1,enumerable:!0,get:a})},o.n=function(s){var i=s&&s.__esModule?function(){return s.default}:function(){return s};return o.d(i,"a",i),i},o.o=function(s,i){return Object.prototype.hasOwnProperty.call(s,i)},o.p=".",o(o.s=10)}([function(u,o){u.exports={"#":{pattern:/\d/},X:{pattern:/[0-9a-zA-Z]/},S:{pattern:/[a-zA-Z]/},A:{pattern:/[a-zA-Z]/,transform:function(e){return e.toLocaleUpperCase()}},a:{pattern:/[a-zA-Z]/,transform:function(e){return e.toLocaleLowerCase()}},"!":{escape:!0}}},function(u,o,e){function s(t){var l=document.createEvent("Event");return l.initEvent(t,!0,!0),l}var i=e(2),a=e(0),d=e.n(a);o.a=function(t,l){var p=l.value;if((Array.isArray(p)||typeof p=="string")&&(p={mask:p,tokens:d.a}),t.tagName.toLocaleUpperCase()!=="INPUT"){var _=t.getElementsByTagName("input");if(_.length!==1)throw new Error("v-mask directive requires 1 input, found "+_.length);t=_[0]}t.oninput=function(y){if(y.isTrusted){var k=t.selectionEnd,x=t.value[k-1];for(t.value=e.i(i.a)(t.value,p.mask,!0,p.tokens);k<t.value.length&&t.value.charAt(k-1)!==x;)k++;t===document.activeElement&&(t.setSelectionRange(k,k),setTimeout(function(){t.setSelectionRange(k,k)},0)),t.dispatchEvent(s("input"))}};var h=e.i(i.a)(t.value,p.mask,!0,p.tokens);h!==t.value&&(t.value=h,t.dispatchEvent(s("input")))}},function(u,o,e){var s=e(6),i=e(5);o.a=function(a,d){var t=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2],l=arguments[3];return Array.isArray(d)?e.i(i.a)(s.a,d,l)(a,d,t,l):e.i(s.a)(a,d,t,l)}},function(u,o,e){function s(_){_.component(l.a.name,l.a),_.directive("mask",d.a)}Object.defineProperty(o,"__esModule",{value:!0});var i=e(0),a=e.n(i),d=e(1),t=e(7),l=e.n(t);e.d(o,"TheMask",function(){return l.a}),e.d(o,"mask",function(){return d.a}),e.d(o,"tokens",function(){return a.a}),e.d(o,"version",function(){return p});var p="0.11.1";o.default=s,typeof window!="undefined"&&window.Vue&&window.Vue.use(s)},function(u,o,e){Object.defineProperty(o,"__esModule",{value:!0});var s=e(1),i=e(0),a=e.n(i),d=e(2);o.default={name:"TheMask",props:{value:[String,Number],mask:{type:[String,Array],required:!0},masked:{type:Boolean,default:!1},tokens:{type:Object,default:function(){return a.a}}},directives:{mask:s.a},data:function(){return{lastValue:null,display:this.value}},watch:{value:function(t){t!==this.lastValue&&(this.display=t)},masked:function(){this.refresh(this.display)}},computed:{config:function(){return{mask:this.mask,tokens:this.tokens,masked:this.masked}}},methods:{onInput:function(t){t.isTrusted||this.refresh(t.target.value)},refresh:function(l){this.display=l;var l=e.i(d.a)(l,this.mask,this.masked,this.tokens);l!==this.lastValue&&(this.lastValue=l,this.$emit("input",l))}}}},function(u,o,e){function s(i,a,d){return a=a.sort(function(t,l){return t.length-l.length}),function(t,l){for(var p=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2],_=0;_<a.length;){var h=a[_];_++;var y=a[_];if(!(y&&i(t,y,!0,d).length>h.length))return i(t,h,p,d)}return""}}o.a=s},function(u,o,e){function s(i,a){var d=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2],t=arguments[3];i=i||"",a=a||"";for(var l=0,p=0,_="";l<a.length&&p<i.length;){var h=a[l],y=t[h],k=i[p];y&&!y.escape?(y.pattern.test(k)&&(_+=y.transform?y.transform(k):k,l++),p++):(y&&y.escape&&(l++,h=a[l]),d&&(_+=h),k===h&&p++,l++)}for(var x="";l<a.length&&d;){var h=a[l];if(t[h]){x="";break}x+=h,l++}return _+x}o.a=s},function(u,o,e){var s=e(8)(e(4),e(9),null,null);u.exports=s.exports},function(u,o){u.exports=function(e,s,i,a){var d,t=e=e||{},l=typeof e.default;l!=="object"&&l!=="function"||(d=e,t=e.default);var p=typeof t=="function"?t.options:t;if(s&&(p.render=s.render,p.staticRenderFns=s.staticRenderFns),i&&(p._scopeId=i),a){var _=p.computed||(p.computed={});Object.keys(a).forEach(function(h){var y=a[h];_[h]=function(){return y}})}return{esModule:d,exports:t,options:p}}},function(u,o){u.exports={render:function(){var e=this,s=e.$createElement;return(e._self._c||s)("input",{directives:[{name:"mask",rawName:"v-mask",value:e.config,expression:"config"}],attrs:{type:"text"},domProps:{value:e.display},on:{input:e.onInput}})},staticRenderFns:[]}},function(u,o,e){u.exports=e(3)}])})})(R);const de={name:"Input",props:["value","name","type","placeholder"],directives:{mask:R.exports.mask},methods:{updateValue(n){this.$emit("updateValue",n.target.name,n.target.value)}}},pe={class:"form__label"},_e=["placeholder"],he=["type","name","placeholder"],me={class:"form__value"};function fe(n,c,u,o,e,s){const i=U("mask");return m(),v("label",pe,[u.type==="tel"?I((m(),v("input",{key:0,class:"form__input",type:"tel",name:"phone",placeholder:u.placeholder,onChange:c[0]||(c[0]=(...a)=>s.updateValue&&s.updateValue(...a))},null,40,_e)),[[i,"+7(###)-###-##-##"]]):(m(),v("input",{key:1,class:"form__input",type:u.type,name:u.name,placeholder:u.placeholder,onChange:c[1]||(c[1]=(...a)=>s.updateValue&&s.updateValue(...a))},null,40,he)),r("span",me,f(u.value),1)])}var ve=w(de,[["render",fe]]),E=A("deliveries",{state:()=>({deliveries:[]}),actions:{async getDeliveries(){await fetch("https://vue-moire.skillbox.cc/api/deliveries").then(n=>n.json()).then(n=>{this.deliveries=n}).catch(n=>{console.error("Error:",n)})}},persist:{storage:sessionStorage}}),N=A("payments",{state:()=>({payments:[]}),actions:{async getPayments(n){await fetch(`https://vue-moire.skillbox.cc/api/payments?deliveryTypeId=${n}`).then(c=>c.json()).then(c=>{this.payments=c}).catch(c=>{console.error("Error:",c)})}},persist:{storage:sessionStorage}});const ye={components:{Result:ce,Breadcrumbs:B,Input:ve},data(){return{orderIsProcessed:!1,deliveries:[],currentDelivery:"",items:[],totalPrice:0,errorOccured:!1,payments:[],currentPayment:[],fullName:"",fullAddress:"",phoneNumber:"",emailAddress:"",commentText:"",accessKey:""}},computed:{...O(C,E,N,D),computeItemsCount(){const n=this.items.length;return n===0?"0":n===1?"1 \u0442\u043E\u0432\u0430\u0440":[2,3,4].includes(n)?`${n} \u0442\u043E\u0432\u0430\u0440\u0430`:`${n} \u0442\u043E\u0432\u0430\u0440\u043E\u0432`}},methods:{updateInputValue(n,c){n==="name"?this.fullName=c:n==="address"?this.fullAddress=c:n==="phone"?this.phoneNumber=c:n==="email"&&(this.emailAddress=c)},viewResult(){this.orderIsProcessed=!0},changeDelivery(n){this.currentDelivery=n,this.updatePayments()},changePayment(n){this.currentPayment=n},setDeliveryPrice(n){return n==="0"?"\u0411\u0435\u0441\u043F\u043B\u0430\u0442\u043D\u043E":`${n} \u20BD`},updatePayments(){N().getPayments(this.currentDelivery.id)},calculateTotal(){this.totalPrice=0,this.items.map(n=>{this.totalPrice+=n.price*n.quantity})},isEmailValidated(){return new RegExp("[a-z0-9]+@[a-z]+.[a-z]{2,3}").test(this.emailAddress)},isFieldsChecked(){return this.fullName===""?(alert("\u041D\u0435\u043E\u0431\u0445\u043E\u0434\u0438\u043C\u043E \u0437\u0430\u043F\u043E\u043B\u043D\u0438\u0442\u044C \u0424\u0418\u041E"),!1):this.fullAddress===""?(alert("\u041D\u0435\u043E\u0431\u0445\u043E\u0434\u0438\u043C\u043E \u0437\u0430\u043F\u043E\u043B\u043D\u0438\u0442\u044C \u0430\u0434\u0440\u0435\u0441"),!1):this.phoneNumber.length<17?(alert("\u041D\u0435\u043E\u0431\u0445\u043E\u0434\u0438\u043C\u043E \u0437\u0430\u043F\u043E\u043B\u043D\u0438\u0442\u044C \u043D\u043E\u043C\u0435\u0440 \u0442\u0435\u043B\u0435\u0444\u043E\u043D\u0430"),!1):this.isEmailValidated()?!0:(alert("\u041D\u0435\u043E\u0431\u0445\u043E\u0434\u0438\u043C\u043E \u0437\u0430\u043F\u043E\u043B\u043D\u0438\u0442\u044C \u0430\u0434\u0440\u0435\u0441 \u044D\u043B\u0435\u043A\u0442\u0440\u043E\u043D\u043D\u043E\u0439 \u043F\u043E\u0447\u0442\u044B"),!1)},onSubmit(){!this.isFieldsChecked()||D().placeOrder(this.accessKey,this.fullName,this.fullAddress,this.phoneNumber,this.emailAddress,this.currentDelivery.id,this.currentPayment.id,this.commentText)}},created(){E().getDeliveries(),this.deliveriesStore.$subscribe((n,c)=>{this.deliveries=c.deliveries,this.currentDelivery=this.deliveries[0],this.updatePayments()}),this.paymentsStore.$subscribe((n,c)=>{this.payments=c.payments,this.currentPayment=this.payments[0]}),this.accessKey=S().accessKey,this.accessKey===""&&(S().setAccessKey(),this.accessKey=S().accessKey),C().getBasket(this.accessKey),this.basketStore.$subscribe((n,c)=>{this.items=c.basket,this.calculateTotal()}),this.status="200",this.orderStore.$subscribe((n,c)=>{this.status=c.status,this.status==200?this.viewResult():this.errorOccured=!0})}},ke={class:"content container"},be={key:0,class:"checkout"},ge={class:"content__top"},xe={key:0,class:"cart"},Pe={class:"cart__form form"},Ve={class:"cart__field"},Te={class:"cart__data"},we={class:"form__label"},Se=r("span",{class:"form__value"},"\u041A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0439 \u043A \u0437\u0430\u043A\u0430\u0437\u0443",-1),Ie={class:"cart__options"},De=r("h3",{class:"cart__title"},"\u0414\u043E\u0441\u0442\u0430\u0432\u043A\u0430",-1),Ae={class:"cart__options options"},Ce={class:"options__item"},Ee={class:"options__label"},Ne=["value","checked","onClick"],Oe={class:"options__value"},$e=r("h3",{class:"cart__title"},"\u041E\u043F\u043B\u0430\u0442\u0430",-1),Be={class:"cart__options options"},Re={class:"options__item"},Ue={class:"options__label"},je=["value","checked","onClick"],Ke={class:"options__value"},qe={class:"cart__block"},Le={class:"cart__orders"},Me={class:"cart__order"},ze=r("span",null,"\u0410\u0440\u0442\u0438\u043A\u0443\u043B: 150030",-1),Fe={class:"cart__total"},Ze=r("h4",null,"\u0417\u0430\u044F\u0432\u043A\u0430 \u043D\u0435 \u043E\u0442\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0430!",-1),Ge=r("p",null," \u041F\u043E\u0445\u043E\u0436\u0435 \u043F\u0440\u043E\u0438\u0437\u043E\u0448\u043B\u0430 \u043E\u0448\u0438\u0431\u043A\u0430. \u041F\u043E\u043F\u0440\u043E\u0431\u0443\u0439\u0442\u0435 \u043E\u0442\u043F\u0440\u0430\u0432\u0438\u0442\u044C \u0441\u043D\u043E\u0432\u0430 \u0438\u043B\u0438 \u043F\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u0435 \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0443. ",-1),He=[Ze,Ge];function Xe(n,c,u,o,e,s){const i=P("Breadcrumbs"),a=P("Input"),d=P("Result");return m(),v("main",ke,[e.orderIsProcessed?(m(),$(d,{key:1})):(m(),v("div",be,[r("div",ge,[b(i,{\u0441heckout:e.currentDelivery,title:"\u041E\u0444\u043E\u0440\u043C\u043B\u0435\u043D\u0438\u0435 \u0437\u0430\u043A\u0430\u0437\u0430"},null,8,["\u0441heckout"])]),e.orderIsProcessed?q("",!0):(m(),v("section",xe,[r("div",Pe,[r("div",Ve,[r("div",Te,[b(a,{onUpdateValue:s.updateInputValue,value:"\u0424\u0418\u041E",name:"name",type:"text",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0432\u0430\u0448\u0435 \u043F\u043E\u043B\u043D\u043E\u0435 \u0438\u043C\u044F"},null,8,["onUpdateValue"]),b(a,{onUpdateValue:s.updateInputValue,value:"\u0410\u0434\u0440\u0435\u0441 \u0434\u043E\u0441\u0442\u0430\u0432\u043A\u0438",name:"address",type:"text",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0432\u0430\u0448 \u0430\u0434\u0440\u0435\u0441"},null,8,["onUpdateValue"]),b(a,{onUpdateValue:s.updateInputValue,value:"\u0422\u0435\u043B\u0435\u0444\u043E\u043D",name:"phone",type:"tel",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0432\u0430\u0448 \u0442\u0435\u043B\u0435\u0444\u043E\u043D"},null,8,["onUpdateValue"]),b(a,{onUpdateValue:s.updateInputValue,value:"Email",name:"email",type:"email",placeholder:"\u0412\u0432\u0435\u0434\u0438 \u0432\u0430\u0448 Email"},null,8,["onUpdateValue"]),r("label",we,[I(r("textarea",{class:"form__input form__input--area",name:"comments",placeholder:"\u0412\u0430\u0448\u0438 \u043F\u043E\u0436\u0435\u043B\u0430\u043D\u0438\u044F","onUpdate:modelValue":c[0]||(c[0]=t=>e.commentText=t)},null,512),[[j,e.commentText]]),Se])]),r("div",Ie,[De,r("ul",Ae,[(m(!0),v(V,null,T(e.deliveries,(t,l)=>(m(),v("li",Ce,[r("label",Ee,[r("input",{class:"options__radio sr-only",type:"radio",name:"delivery",value:t.id,checked:l===0,onClick:p=>s.changeDelivery(t)},null,8,Ne),r("span",Oe,[g(f(t.title)+": ",1),r("b",null,f(s.setDeliveryPrice(t.price)),1)])])]))),256))]),$e,r("ul",Be,[(m(!0),v(V,null,T(e.payments,(t,l)=>(m(),v("li",Re,[r("label",Ue,[r("input",{class:"options__radio sr-only",type:"radio",name:"pay",value:t.id,checked:l===0,onClick:p=>s.changePayment(t)},null,8,je),r("span",Ke,f(t.title),1)])]))),256))])])]),r("div",qe,[r("ul",Le,[(m(!0),v(V,null,T(e.items,t=>(m(),v("li",Me,[r("h3",null,f(t.product.title),1),r("b",null,f(t.price*t.quantity)+"\u20BD",1),ze]))),256))]),r("div",Fe,[r("p",null,[g(f(e.currentDelivery.title)+": ",1),r("b",null,f(s.setDeliveryPrice(e.currentDelivery.price)),1)]),r("p",null,[g("\u0418\u0442\u043E\u0433\u043E: "),r("b",null,f(s.computeItemsCount),1),g(" \u043D\u0430 \u0441\u0443\u043C\u043C\u0443 "),r("b",null,f(e.totalPrice)+" \u20BD",1)])]),r("button",{class:"cart__button button button--primery",onClick:c[1]||(c[1]=(...t)=>s.onSubmit&&s.onSubmit(...t))}," \u041E\u0444\u043E\u0440\u043C\u0438\u0442\u044C \u0437\u0430\u043A\u0430\u0437 ")]),I((m(),v("div",{class:"cart__error form__error-block",key:e.errorOccured},He)),[[K,e.errorOccured]])])]))]))])}var Je=w(ye,[["render",Xe]]);const Ye={__name:"CheckoutView",setup(n){return(c,u)=>(m(),$(Je))}};export{Ye as default};
