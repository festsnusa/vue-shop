import{B}from"./Breadcrumbs.0c0c436c.js";import{_ as C,l as U,o as v,c as g,w as x,b as u,t as y,j as I,q as M,m as j,u as E,a as N,r as S,f as k,v as K,F as A,h as P,d as V,i as R}from"./index.0b215802.js";import{u as w}from"./order.f34f03dd.js";var z=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},O={exports:{}};(function(s,c){(function(d,a){s.exports=a()})(z,function(){return function(d){function a(t){if(e[t])return e[t].exports;var n=e[t]={i:t,l:!1,exports:{}};return d[t].call(n.exports,n,n.exports,a),n.l=!0,n.exports}var e={};return a.m=d,a.c=e,a.i=function(t){return t},a.d=function(t,n,o){a.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:o})},a.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(n,"a",n),n},a.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},a.p=".",a(a.s=10)}([function(d,a){d.exports={"#":{pattern:/\d/},X:{pattern:/[0-9a-zA-Z]/},S:{pattern:/[a-zA-Z]/},A:{pattern:/[a-zA-Z]/,transform:function(e){return e.toLocaleUpperCase()}},a:{pattern:/[a-zA-Z]/,transform:function(e){return e.toLocaleLowerCase()}},"!":{escape:!0}}},function(d,a,e){function t(r){var l=document.createEvent("Event");return l.initEvent(r,!0,!0),l}var n=e(2),o=e(0),i=e.n(o);a.a=function(r,l){var h=l.value;if((Array.isArray(h)||typeof h=="string")&&(h={mask:h,tokens:i.a}),r.tagName.toLocaleUpperCase()!=="INPUT"){var m=r.getElementsByTagName("input");if(m.length!==1)throw new Error("v-mask directive requires 1 input, found "+m.length);r=m[0]}r.oninput=function(f){if(f.isTrusted){var _=r.selectionEnd,b=r.value[_-1];for(r.value=e.i(n.a)(r.value,h.mask,!0,h.tokens);_<r.value.length&&r.value.charAt(_-1)!==b;)_++;r===document.activeElement&&(r.setSelectionRange(_,_),setTimeout(function(){r.setSelectionRange(_,_)},0)),r.dispatchEvent(t("input"))}};var p=e.i(n.a)(r.value,h.mask,!0,h.tokens);p!==r.value&&(r.value=p,r.dispatchEvent(t("input")))}},function(d,a,e){var t=e(6),n=e(5);a.a=function(o,i){var r=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2],l=arguments[3];return Array.isArray(i)?e.i(n.a)(t.a,i,l)(o,i,r,l):e.i(t.a)(o,i,r,l)}},function(d,a,e){function t(m){m.component(l.a.name,l.a),m.directive("mask",i.a)}Object.defineProperty(a,"__esModule",{value:!0});var n=e(0),o=e.n(n),i=e(1),r=e(7),l=e.n(r);e.d(a,"TheMask",function(){return l.a}),e.d(a,"mask",function(){return i.a}),e.d(a,"tokens",function(){return o.a}),e.d(a,"version",function(){return h});var h="0.11.1";a.default=t,typeof window!="undefined"&&window.Vue&&window.Vue.use(t)},function(d,a,e){Object.defineProperty(a,"__esModule",{value:!0});var t=e(1),n=e(0),o=e.n(n),i=e(2);a.default={name:"TheMask",props:{value:[String,Number],mask:{type:[String,Array],required:!0},masked:{type:Boolean,default:!1},tokens:{type:Object,default:function(){return o.a}}},directives:{mask:t.a},data:function(){return{lastValue:null,display:this.value}},watch:{value:function(r){r!==this.lastValue&&(this.display=r)},masked:function(){this.refresh(this.display)}},computed:{config:function(){return{mask:this.mask,tokens:this.tokens,masked:this.masked}}},methods:{onInput:function(r){r.isTrusted||this.refresh(r.target.value)},refresh:function(l){this.display=l;var l=e.i(i.a)(l,this.mask,this.masked,this.tokens);l!==this.lastValue&&(this.lastValue=l,this.$emit("input",l))}}}},function(d,a,e){function t(n,o,i){return o=o.sort(function(r,l){return r.length-l.length}),function(r,l){for(var h=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2],m=0;m<o.length;){var p=o[m];m++;var f=o[m];if(!(f&&n(r,f,!0,i).length>p.length))return n(r,p,h,i)}return""}}a.a=t},function(d,a,e){function t(n,o){var i=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2],r=arguments[3];n=n||"",o=o||"";for(var l=0,h=0,m="";l<o.length&&h<n.length;){var p=o[l],f=r[p],_=n[h];f&&!f.escape?(f.pattern.test(_)&&(m+=f.transform?f.transform(_):_,l++),h++):(f&&f.escape&&(l++,p=o[l]),i&&(m+=p),_===p&&h++,l++)}for(var b="";l<o.length&&i;){var p=o[l];if(r[p]){b="";break}b+=p,l++}return m+b}a.a=t},function(d,a,e){var t=e(8)(e(4),e(9),null,null);d.exports=t.exports},function(d,a){d.exports=function(e,t,n,o){var i,r=e=e||{},l=typeof e.default;l!=="object"&&l!=="function"||(i=e,r=e.default);var h=typeof r=="function"?r.options:r;if(t&&(h.render=t.render,h.staticRenderFns=t.staticRenderFns),n&&(h._scopeId=n),o){var m=h.computed||(h.computed={});Object.keys(o).forEach(function(p){var f=o[p];m[p]=function(){return f}})}return{esModule:i,exports:r,options:h}}},function(d,a){d.exports={render:function(){var e=this,t=e.$createElement;return(e._self._c||t)("input",{directives:[{name:"mask",rawName:"v-mask",value:e.config,expression:"config"}],attrs:{type:"text"},domProps:{value:e.display},on:{input:e.onInput}})},staticRenderFns:[]}},function(d,a,e){d.exports=e(3)}])})})(O);const F={name:"Input",props:["value","name","type","placeholder","errorMessage","errorVisible"],directives:{mask:O.exports.mask},methods:{updateValue(s){this.$emit("updateValue",s.target.name,s.target.value)}}},L={class:"form__label"},q=["placeholder"],Z=["type","name","placeholder"],G={class:"form__value"};function X(s,c,d,a,e,t){const n=U("mask");return v(),g("label",L,[d.type==="tel"?x((v(),g("input",{key:0,class:"form__input",type:"tel",name:"phone",placeholder:d.placeholder,onChange:c[0]||(c[0]=(...o)=>t.updateValue&&t.updateValue(...o))},null,40,q)),[[n,"+7(###)-###-##-##"]]):(v(),g("input",{key:1,class:"form__input",type:d.type,name:d.name,placeholder:d.placeholder,onChange:c[1]||(c[1]=(...o)=>t.updateValue&&t.updateValue(...o))},null,40,Z)),u("span",G,y(d.value),1),x(u("span",{class:"form__error"},y(d.errorMessage),513),[[I,d.errorVisible]])])}var H=C(F,[["render",X]]),D=M("deliveries",{state:()=>({deliveries:[]}),actions:{async getDeliveries(){await fetch("https://vue-moire.skillbox.cc/api/deliveries").then(s=>s.json()).then(s=>{this.deliveries=s}).catch(s=>{console.error("Error:",s)})}},persist:{storage:sessionStorage}}),T=M("payments",{state:()=>({payments:[]}),actions:{async getPayments(s){await fetch(`https://vue-moire.skillbox.cc/api/payments?deliveryTypeId=${s}`).then(c=>c.json()).then(c=>{this.payments=c}).catch(c=>{console.error("Error:",c)})}},persist:{storage:sessionStorage}});const J={components:{Breadcrumbs:B,Input:H},data(){return{deliveries:[],currentDelivery:"",items:[],totalPrice:0,errorOccured:!1,payments:[],currentPayment:[],fullName:"",fullAddress:"",phoneNumber:"",emailAddress:"",commentText:"",accessKey:"",fullNameError:!1,fullAddressError:!1,phoneNumberError:!1,emailError:!1}},computed:{...j(N,D,T,w),computeItemsCount(){const s=this.items.length;return s===0?"0":s===1?"1 \u0442\u043E\u0432\u0430\u0440":[2,3,4].includes(s)?`${s} \u0442\u043E\u0432\u0430\u0440\u0430`:`${s} \u0442\u043E\u0432\u0430\u0440\u043E\u0432`}},methods:{updateInputValue(s,c){s==="name"?this.fullName=c:s==="address"?this.fullAddress=c:s==="phone"?this.phoneNumber=c:s==="email"&&(this.emailAddress=c)},viewResult(s){this.$router.push({name:"checkoutId",params:{id:s}})},changeDelivery(s){this.currentDelivery=s,this.updatePayments()},changePayment(s){this.currentPayment=s},setDeliveryPrice(s){return s==="0"?"\u0411\u0435\u0441\u043F\u043B\u0430\u0442\u043D\u043E":`${s} \u20BD`},updatePayments(){T().getPayments(this.currentDelivery.id)},calculateTotal(){this.totalPrice=0,this.items.map(s=>{this.totalPrice+=s.price*s.quantity})},isEmailValidated(){return new RegExp("[a-z0-9]+@[a-z]+.[a-z]{2,3}").test(this.emailAddress)},isFieldsChecked(){let s=!0;return this.fullName===""?(this.fullNameError=!0,s=!1):this.fullNameError=!1,this.fullAddress===""?(this.fullAddressError=!0,s=!1):this.fullAddressError=!1,this.phoneNumber.length<17?(this.phoneNumberError=!0,s=!1):this.phoneNumberError=!1,this.isEmailValidated()?this.emailError=!1:(this.emailError=!0,s=!1),s},onSubmit(){!this.isFieldsChecked()||w().placeOrder(this.accessKey,this.fullName,this.fullAddress,this.phoneNumber,this.emailAddress,this.currentDelivery.id,this.currentPayment.id,this.commentText)}},created(){D().getDeliveries(),this.deliveriesStore.$subscribe((s,c)=>{this.deliveries=c.deliveries,this.currentDelivery=this.deliveries[0],this.updatePayments()}),this.paymentsStore.$subscribe((s,c)=>{this.payments=c.payments,this.currentPayment=this.payments[0]}),this.accessKey=E().accessKey,this.accessKey===""&&(E().setAccessKey(),this.accessKey=E().accessKey),N().getBasket(this.accessKey),this.basketStore.$subscribe((s,c)=>{this.items=c.basket,this.calculateTotal()}),this.status="200",this.orderStore.$subscribe((s,c)=>{this.status=c.status,this.status==200?this.viewResult(c.order.id):this.errorOccured=!0})}},Q={class:"content container"},W={class:"checkout"},Y={class:"content__top"},$={class:"cart"},ee={class:"cart__form form"},te={class:"cart__field"},se={class:"cart__data"},re={class:"form__label"},ae=u("span",{class:"form__value"},"\u041A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0439 \u043A \u0437\u0430\u043A\u0430\u0437\u0443",-1),ne={class:"cart__options"},oe=u("h3",{class:"cart__title"},"\u0414\u043E\u0441\u0442\u0430\u0432\u043A\u0430",-1),ie={class:"cart__options options"},le={class:"options__item"},ue={class:"options__label"},ce=["value","checked","onClick"],de={class:"options__value"},he=u("h3",{class:"cart__title"},"\u041E\u043F\u043B\u0430\u0442\u0430",-1),me={class:"cart__options options"},pe={class:"options__item"},fe={class:"options__label"},_e=["value","checked","onClick"],ve={class:"options__value"},ye={class:"cart__block"},ge={class:"cart__orders"},be={class:"cart__order"},ke=u("span",null,"\u0410\u0440\u0442\u0438\u043A\u0443\u043B: 150030",-1),Ve={class:"cart__total"},xe=u("h4",null,"\u0417\u0430\u044F\u0432\u043A\u0430 \u043D\u0435 \u043E\u0442\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0430!",-1),Ee=u("p",null," \u041F\u043E\u0445\u043E\u0436\u0435 \u043F\u0440\u043E\u0438\u0437\u043E\u0448\u043B\u0430 \u043E\u0448\u0438\u0431\u043A\u0430. \u041F\u043E\u043F\u0440\u043E\u0431\u0443\u0439\u0442\u0435 \u043E\u0442\u043F\u0440\u0430\u0432\u0438\u0442\u044C \u0441\u043D\u043E\u0432\u0430 \u0438\u043B\u0438 \u043F\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u0435 \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0443. ",-1),Ae=[xe,Ee];function Pe(s,c,d,a,e,t){const n=S("Breadcrumbs"),o=S("Input");return v(),g("main",Q,[u("div",W,[u("div",Y,[k(n,{\u0441heckout:e.currentDelivery,title:"\u041E\u0444\u043E\u0440\u043C\u043B\u0435\u043D\u0438\u0435 \u0437\u0430\u043A\u0430\u0437\u0430"},null,8,["\u0441heckout"])]),u("section",$,[u("div",ee,[u("div",te,[u("div",se,[k(o,{onUpdateValue:t.updateInputValue,value:"\u0424\u0418\u041E",name:"name",type:"text",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0432\u0430\u0448\u0435 \u043F\u043E\u043B\u043D\u043E\u0435 \u0438\u043C\u044F",errorMessage:"\u041D\u0435\u043E\u0431\u0445\u043E\u0434\u0438\u043C\u043E \u0437\u0430\u043F\u043E\u043B\u043D\u0438\u0442\u044C \u0424\u0418\u041E",errorVisible:e.fullNameError},null,8,["onUpdateValue","errorVisible"]),k(o,{onUpdateValue:t.updateInputValue,value:"\u0410\u0434\u0440\u0435\u0441 \u0434\u043E\u0441\u0442\u0430\u0432\u043A\u0438",name:"address",type:"text",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0432\u0430\u0448 \u0430\u0434\u0440\u0435\u0441",errorMessage:"\u041D\u0435\u043E\u0431\u0445\u043E\u0434\u0438\u043C\u043E \u0437\u0430\u043F\u043E\u043B\u043D\u0438\u0442\u044C \u0430\u0434\u0440\u0435\u0441",errorVisible:e.fullAddressError},null,8,["onUpdateValue","errorVisible"]),k(o,{onUpdateValue:t.updateInputValue,value:"\u0422\u0435\u043B\u0435\u0444\u043E\u043D",name:"phone",type:"tel",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0432\u0430\u0448 \u0442\u0435\u043B\u0435\u0444\u043E\u043D",errorMessage:"\u041D\u0435\u043E\u0431\u0445\u043E\u0434\u0438\u043C\u043E \u0437\u0430\u043F\u043E\u043B\u043D\u0438\u0442\u044C \u043D\u043E\u043C\u0435\u0440 \u0442\u0435\u043B\u0435\u0444\u043E\u043D\u0430",errorVisible:e.phoneNumberError},null,8,["onUpdateValue","errorVisible"]),k(o,{onUpdateValue:t.updateInputValue,value:"Email",name:"email",type:"email",placeholder:"\u0412\u0432\u0435\u0434\u0438 \u0432\u0430\u0448 Email",errorMessage:"\u041D\u0435\u043E\u0431\u0445\u043E\u0434\u0438\u043C\u043E \u0437\u0430\u043F\u043E\u043B\u043D\u0438\u0442\u044C \u0430\u0434\u0440\u0435\u0441 \u044D\u043B\u0435\u043A\u0442\u0440\u043E\u043D\u043D\u043E\u0439 \u043F\u043E\u0447\u0442\u044B",errorVisible:e.emailError},null,8,["onUpdateValue","errorVisible"]),u("label",re,[x(u("textarea",{class:"form__input form__input--area",name:"comments",placeholder:"\u0412\u0430\u0448\u0438 \u043F\u043E\u0436\u0435\u043B\u0430\u043D\u0438\u044F","onUpdate:modelValue":c[0]||(c[0]=i=>e.commentText=i)},null,512),[[K,e.commentText]]),ae])]),u("div",ne,[oe,u("ul",ie,[(v(!0),g(A,null,P(e.deliveries,(i,r)=>(v(),g("li",le,[u("label",ue,[u("input",{class:"options__radio sr-only",type:"radio",name:"delivery",value:i.id,checked:r===0,onClick:l=>t.changeDelivery(i)},null,8,ce),u("span",de,[V(y(i.title)+": ",1),u("b",null,y(t.setDeliveryPrice(i.price)),1)])])]))),256))]),he,u("ul",me,[(v(!0),g(A,null,P(e.payments,(i,r)=>(v(),g("li",pe,[u("label",fe,[u("input",{class:"options__radio sr-only",type:"radio",name:"pay",value:i.id,checked:r===0,onClick:l=>t.changePayment(i)},null,8,_e),u("span",ve,y(i.title),1)])]))),256))])])]),u("div",ye,[u("ul",ge,[(v(!0),g(A,null,P(e.items,i=>(v(),g("li",be,[u("h3",null,y(i.product.title),1),u("b",null,y(i.price*i.quantity)+"\u20BD",1),ke]))),256))]),u("div",Ve,[u("p",null,[V(y(e.currentDelivery.title)+": ",1),u("b",null,y(t.setDeliveryPrice(e.currentDelivery.price)),1)]),u("p",null,[V("\u0418\u0442\u043E\u0433\u043E: "),u("b",null,y(t.computeItemsCount),1),V(" \u043D\u0430 \u0441\u0443\u043C\u043C\u0443 "),u("b",null,y(e.totalPrice)+" \u20BD",1)])]),u("button",{class:"cart__button button button--primery",onClick:c[1]||(c[1]=(...i)=>t.onSubmit&&t.onSubmit(...i))}," \u041E\u0444\u043E\u0440\u043C\u0438\u0442\u044C \u0437\u0430\u043A\u0430\u0437 ")]),x((v(),g("div",{class:"cart__error form__error-block",key:e.errorOccured},Ae)),[[I,e.errorOccured]])])])])])}var Ne=C(J,[["render",Pe]]);const Te={__name:"CheckoutView",setup(s){return(c,d)=>(v(),R(Ne))}};export{Te as default};
